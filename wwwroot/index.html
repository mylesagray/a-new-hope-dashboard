<html>

<head>
    <meta charset="utf-8"/>
    <script type="text/javascript" src="js/lib/signalr-client-1.0.0-alpha2-final.js"></script>
</head>

<body>
    <div id="main"></div>
    <script type="text/javascript" src="js/main.js"></script>
    <script>
        var node = document.getElementById('main');
        var app = Elm.Main.embed(node);

        const logger = new signalR.ConsoleLogger(signalR.LogLevel.Information);
        const smokeHub = new signalR.HttpConnection(`http://${document.location.host}/smoke`, { logger: logger });
        const smokeConn = new signalR.HubConnection(smokeHub, logger);

        smokeConn.onClosed = e => {
            console.log('Connection closed');
        };

        smokeConn.on('updateLastReceived', dateTime => {
            app.ports.lastReceiveds.send(dateTime);
        });

        smokeConn.on('updateSmokeStatus', smokeStatus => {
            app.ports.smokeStatuses.send(smokeStatus);
        });

        smokeConn.start().then(() => smokeConn.invoke('send', { count: 42 }));

    </script>
</body>

</html>