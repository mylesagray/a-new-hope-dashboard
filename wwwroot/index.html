<html>

<head>
    <meta charset="utf-8" />
    <script type="text/javascript" src="js/lib/signalr.min.js"></script>
    <link rel="stylesheet" href="assets/styles.css">
</head>

<body>
    <div class="backdrop"></div>
    <header class="itq-header">
        <img class="itq-logo" src="assets/itq-logo.svg" alt="ITQ Logo" />
        <h1 class="itq-title">Smokestate</h1>
    </header>

    <div id="main"></div>

    <footer class="footer">
        <a class="itq-link" href="https://www.itq.nl" target="_blank">itq</a>
    </footer>



    <script type="text/javascript" src="js/main.js"></script>
    <script>
        var app = Elm.Main.init({
            node: document.getElementById('main')
        });

        const smokeConnection = new signalR.HubConnectionBuilder().withUrl("/smoke").build();

        smokeConnection.onClosed = e => {
            console.log('Connection closed');
        };

        smokeConnection.on('updateLastReceived', dateTime => {
            app.ports.lastReceiveds.send(dateTime);
        });

        smokeConnection.on('updateTestResults', testResults => {
            console.log("updateTestResults");
            console.log(testResults);
            app.ports.testResults.send(testResults);
        });

        smokeConnection.start().catch(function (err) {
            return console.error(err.toString());
        });

    </script>
</body>

</html>