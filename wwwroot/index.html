<html>

<head>
    <meta charset="utf-8" />
    <script type="text/javascript" src="js/lib/signalr.min.js"></script>
</head>

<body>
    <div id="main"></div>
    <script type="text/javascript" src="js/main.js"></script>
    <script>
        var app = Elm.Main.init({
            node: document.getElementById('main')
        });

        const smokeConnection = new signalR.HubConnectionBuilder().withUrl("/smoke").build();

        smokeConnection.onClosed = e => {
            console.log('Connection closed');
        };

        smokeConnection.on('updateLastReceived', dateTime => {
            app.ports.lastReceiveds.send(dateTime);
        });

        smokeConnection.on('updateTestResults', testResults => {
            console.log("updateTestResults");
            console.log(testResults);
            app.ports.testResults.send(testResults);
        });

        smokeConnection.start().catch(function (err) {
            return console.error(err.toString());
        });

    </script>
</body>

</html>