---
jobs:
- name: push-smoketest-dashboard
  build_logs_to_retain: 100
  public: false
  serial: true
  plan:
  - get: resource-git-smoketests-dashboard
  - task: task-deploy
    file: resource-git-smoketests-dashboard/ci/deploy.yml
    params:
      api: {{cf-api}}
      username: {{cf-user}}
      password: {{cf-password}}
      organization: {{cf-org}}
      space: {{cf-space}}
      manifest: {{manifest_filename}}
  on_failure:
    put: slack-alert
    params:
      username: {{slack-username}}
      channel: {{slack-channel}}
      silent: true
      text: "Error deploying smoketests dashboard!"

resource_types:
- name: slack-notification
  type: docker-image
  source:
    repository: cfcommunity/slack-notification-resource
    tag: latest

resources:
- name: resource-git-smoketests-dashboard
  type: git
  source:
    uri: {{git-uri-smoketests-dashboard}}
    branch: deployment
    private_key: {{git-private-key}}

- name: slack-alert
  type: slack-notification
  source:
    url: {{slack-webtoken}}
